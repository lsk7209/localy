name = "localy-workers"
compatibility_date = "2025-01-15"
# OpenNext는 Node.js 런타임을 사용하므로 nodejs_compat 플래그 필수
compatibility_flags = ["nodejs_compat"]

# Cloudflare Pages 배포 설정 (GitHub 자동 배포용)
# Pages는 main 필드와 pages_build_output_dir를 동시에 사용할 수 없습니다
# Pages 배포를 위해서는 pages_build_output_dir만 사용해야 합니다
# 정적 파일은 .open-next/assets 디렉토리에 있으므로 이를 출력 디렉토리로 설정
pages_build_output_dir = ".open-next/assets"

# Cloudflare Workers 배포 설정 (수동 배포용)
# Workers 배포를 원하는 경우 아래 주석을 해제하고 위의 pages_build_output_dir를 주석 처리하세요
# main = ".open-next/worker.js"
# [assets]
# directory = ".open-next/assets"
# binding = "STATIC_ASSETS"

# OpenNext Assets 설정 (Cloudflare Pages에서 정적 파일 제공)
# worker.js가 assets 디렉토리의 정적 파일을 제공합니다
# 참고: Pages에서는 ASSETS가 예약어이므로 다른 이름 사용 불가
# Pages는 자동으로 .open-next/assets 디렉토리를 인식합니다
# [assets] 섹션은 Pages에서 필요하지 않을 수 있습니다

# Workers 배포 시에만 필요한 설정들 (Pages 배포에는 불필요)
# 실제 Workers 배포 전에 아래 ID들을 설정해야 합니다
# 
# D1 Database
# Pages 배포 시에는 Dashboard에서 바인딩 설정 필요
# Dashboard → Pages → Settings → Functions → D1 Database bindings
[[d1_databases]]
binding = "DB"
database_name = "localy-db"
database_id = "eabdfa2a-1676-49e3-b7a1-40155cc6a20c"
#
# KV Namespaces
# Pages 배포 시에는 Dashboard에서 바인딩 설정 필요
# Dashboard → Pages → Settings → Functions → KV Namespace bindings
# 
# 생성 방법:
# 1. npx wrangler kv:namespace create SETTINGS
# 2. 생성된 ID를 아래에 입력
# 3. Preview: npx wrangler kv:namespace create SETTINGS --preview
#
# 또는 스크립트 실행: .\scripts\create-kv-namespaces.ps1

[[kv_namespaces]]
binding = "SETTINGS"
id = "860d8a0dd5f44bf29f2191129986b589"
preview_id = "a3542f4e19dd49129e925ddb3dba5223"

[[kv_namespaces]]
binding = "CACHE"
id = "66d994b0e42c4562af11e9fdda2b35b6"
preview_id = "ccd4be434f184735836e6d570b71430e"

[[kv_namespaces]]
binding = "RATE_LIMIT"
id = "1cd596f086814cbeab50bf58f9561db6"
preview_id = "68e258ee518a43bf8835d9383dd355b1"

[[kv_namespaces]]
binding = "FETCH_FAIL_QUEUE"
id = "d2cc283f85194818bed6935d6f48ee80"
preview_id = "81cad78a35a94d9d917a229797153c15"

[[kv_namespaces]]
binding = "DEAD_FAIL_QUEUE"
id = "ba607411913c4e159f4dfa5acbd8bbaf"
preview_id = "c3ac12f8f0074e7d90a8d5219929698e"

[[kv_namespaces]]
binding = "SITEMAP"
id = "41117fbcc0794b74b477d34243f905eb"
preview_id = "f64fc7ef32c14d6685f1d9c04cee825b"
#
# Queues
# [[queues.producers]]
# queue = "fetch-queue"
# binding = "FETCH_QUEUE"
#
# [[queues.consumers]]
# queue = "fetch-queue"
# max_batch_size = 10
# max_batch_timeout = 30
#
# Cron Triggers
# [triggers]
# crons = [
#   "0 * * * *",      # 초기 수집 (매 시간)
#   "30 * * * *",     # 증분 수집 (매 시간 30분)
#   "*/10 * * * *",   # 정규화 워커 (10분마다)
#   "*/15 * * * *",   # 재시도 워커 (15분마다)
#   "*/20 * * * *",   # AI 생성 워커 (20분마다)
#   "0 */3 * * *"     # 발행 워커 (3시간마다)
# ]
#
# Environment Variables
# [vars]
# API Keys는 wrangler secret put으로 설정
# OPENAI_API_KEY
# PUBLIC_DATA_API_KEY

